version: '3.8'

services:
  nmrih:
    environment:
      - LD_LIBRARY_PATH=".:bin:"
    build: nmrih
    restart: unless-stopped
    command: /bin/sh -c "./init.sh && exec ./srcds_linux -consolelog=/log/nmrih.log -game nmrih -maxplayer 8 +map nmo_broadway"
    stdin_open: true
    tty: true
    ports:
      - 27015:27015
    volumes:
      - log:/log
    env_file: .env

  fastdl:
    build: nmrih/fastdl
    ports:
      - 6996:6996
    configs:
      - source: fastdl-nginx-conf
        target: /etc/nginx/nginx.conf

volumes:
  log:

configs:
  fastdl-nginx-conf:
    file: ./nmrih/fastdl/nginx.conf
